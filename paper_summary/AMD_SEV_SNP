######################## AMD SEV-SNP : STRENGTHENING VM ISOLATION WITH INTEGRITY PROTECTION AND MORE ###################

SEV-SNP prevents software-based integrity attacks and reduce risk associated with compromised memory integrity. Therefore,
if a VM is able to read a private (encrypted) page of memory, it must always read the value it last wrote. SEV-SNP uses 
threat model that does not trust most elements in the VM such as BIOS on the host system, the hypervisor, device drivers, 
other VMs, etc. However, SEV-SNP does not cover attacks such as Denial of Service on Guest, Active DRAM analysis, Architectural
side channels, Page-level Side Channels, and Performance Counter Tracking. SEV-SNP uses Reverse Map Table (RMP) to tackle
integrity attacks that only allows the owner of memory page (the SEV-SNP VM to which the page was assigned) may write that
page. The hypervisor does not need RMP check to read but the RMP check will be needed for writing mode. To tackle memory
re-mapping attack, each guest is given a Guest Physical Address (GPA) that can only be mapped into one System Physical
Address (SPA). To grant access for writing a page, the guest must do page validation (PVALIDATE) for its own memory. 
Whenever a guest requests for new page, the hypervisor will update the RMP (RMPUPDATE) and that guest will do page validation
(PVALIDATE) before writing.

Different from SEV and SEV-ES, SEV-SNP provides Virtual Machine Privilege Levels (VMPL) to allow a guest VM divides its 
address space into four levels. By using VMPL, a guest may contain its own management layer running at high VMPL which 
controls permissions on its other pages. VMPL0 is the highest level of VMPL that uses virtual Top of Memory (vTOM) which
separates into two groups, memory below vTOM is treated as private and memory above vTOM is treated as shared. This mechanism
is a simplification of the previous two SEV technologies that use C-bit for memory separation. To address the exception 
and interrupt, SEV-SNP uses two modes such as 1) Restricted Injection that disables the virtual interrupt queing and 
partially disables the interrupt injection interface, 2) Alternate Injection that has similar process to the first mode but
this mode may be controlled by the guest itself. All interrupts related security sensitive state is saved to the Virtual
Machine Save Area (VMSA). To support remote attestation, SEV-SNP uses Identity Block (IDB) that is supplied by the guest 
owner to the VM. Lastly, SEV-SNP provides Migration Agent (MA) to handle VM migration policy, so that the MA on the source
machine will authenticate the MA on the destination machine, then establishes a protected network connection.

In conclusion, SEV-SNP offers new architectural flexibility in the form of multiple VMPLs, new attestation and key 
derivation architectures, and an arbitrarily flexible migration policy.
