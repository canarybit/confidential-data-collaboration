########################### PROTECTING VM REGISTER STATE WITH SEV-ES ################################

SEV allows VM's memory encryption with a key unique to that VM and unknown to the hypervisor. However, whenever a VM stops
running, due to interrupt or other event, its register contents are saved to hypervisor memory and this memory is readable 
by the hypervisor even if SEV is enabled. Therefore, SEV-ES comes to solve this problem by encrypting all CPU register
contents when a VM stops running. The challenge to encrypt VM's register state is sometimes, the hypervisors do need access
to VM registers to provide services such as device emulation, MSR handling, etc. To address this, SEV-ES technology enables
the guest VM to decide what information it chooses to expose to the hypervisor on a per-case basis.

The single atomic process offered by SEV-ES allows the CPU loads all guest register information including system registers,
GPRs, and floating point registers. This process ensures that the world switch between a hypervisor and guest cannot be 
interrupted. The only state to which a guest VM can be resumed is to the exact same state it was last in. In the SEV-ES 
architecture, the Virtual Machine Control Block (VMCB) used to describe a particular VM is divided into two sections. The
first section is unencrypted "control area" that is owned and managed by the hypervisor and the second section is encrypted
"save area" that is used to store VM register state. Furthermore the architecture of SEV-ES divides the VMEXIT into two 
groups referred to Automatic Exit (AE) that does not need approval from the hypervisor and Non Automatic Exit (NAE) that
needs approval from the Hypervisor.

To enable the guest and hypervisor to easily communicate state information, SEV-ES defines a Guest Hypervisor Communication
Block (GHCB). To initialize SEV-ES VMs, both the initial memory image as well as the initial CPU register state must be 
encrypted by the AMD Secure Processor (AMD-SP). This step is further used for attestation of the guest. In conclusion,
SEV-ES provides additional hardware enforced security for isolating guest VMs from the hypervisor.